proxy_temp_path /tmp/nginx_proxy_temp;
proxy_cache_path  /tmp/nginx_proxy_cache levels=1:2  keys_zone=openerp_cache:100m inactive=3d max_size=1000m;

# Buffer size for nginx storing user's head info
proxy_buffer_size     32k;

# Buffer for proxy. Below setting is for webpages under 32kB.
proxy_buffers         4 32k;

# Buffer size under load. (Typically set to proxy_buffers * 2)
proxy_busy_buffers_size  64k;

# Set cache folder size.
# When size if larger than below setting,
# will read from upstream server directly.
proxy_temp_file_write_size  64k;

proxy_connect_timeout      60;
proxy_send_timeout         60;
proxy_read_timeout         3000;

upstream openerp_server {
        server 127.0.0.1:8069;
}

server {
        listen 80;
        server_name  localhost;

        root rootdirhere/openerp/addons;

        location / {
                proxy_cache              openerp_cache;
                proxy_cache_key $host$request_uri$request_body;
                proxy_cache_valid  200 304 1d;
                proxy_cache_valid  any   1d;

                proxy_next_upstream http_502 http_504 error timeout invalid_header;
                proxy_pass_header Set-Cookie;
                proxy_set_header   Host             $host;
                proxy_set_header   X-Real-IP        $remote_addr;
                proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
                proxy_redirect  off;

                proxy_pass http://openerp_server;

                proxy_buffering on;
                proxy_cache_valid       1d;
                expires 1d;
        }

        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
                proxy_buffering on;
                proxy_cache_valid 1d;
                expires 1d;
        }
}
